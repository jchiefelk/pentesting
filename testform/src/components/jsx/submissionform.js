import React, {Component} from 'react';
import { Router, Route, Link } from 'react-router';
import Actions from '../../actions/actions';
var mammoth = require('mammoth');
require('../css/main.css');
var PublishingStore = require('../../stores/publishingstore');
import Style from '../../style/style';

function SubmissionForm(){
	this.firstName=null;
	this.lastName=null;
	this.subject=null;
	this.abstract=null;
	this.article=null;
	this.saved = false;
};

SubmissionForm.prototype.setForm = function(){

	return (
			<div style={{alignItems: 'center'}}> 
		           		<div style={{display: 'flex',flexDirection: 'column'}}>
			            	<input style={Style.firstname} placeholder="first name" onChange={(e)=> this.editFirstName(e)}/>
			            	<input style={Style.lastname}  placeholder="last name" onChange={(e)=> this.editLastName(e)}/>
			            	<input style={Style.subjects}  placeholder="subject" onChange={(e)=> this.editSubject(e)}/>
			                <textarea style={Style.abstract_container}  placeholder="abstract" onChange={(e)=> this.editAbstract(e)} />
		                </div>
		            
		 </div>
	);
};

SubmissionForm.prototype.saveData = function(){
		this.saved = true;
		Actions.SaveClick();
};

SubmissionForm.prototype.editFirstName = function(e){
		this.firstname = e.target.value;
		Actions.setFirstName(this.firstname);
};

SubmissionForm.prototype.editLastName = function(e){
		this.lastname = e.target.value;
		Actions.setLastName(this.lastname);
};

SubmissionForm.prototype.editSubject = function(e){
		this.subject = e.target.value;
		Actions.setSubjects(this.subject)
};

SubmissionForm.prototype.editAbstract= function(e){
		this.abstract = e.target.value;
		Actions.setAbstract(this.abstract);
};
	//
	// Mammoth code 
    //   
 SubmissionForm.prototype.handleFileSelect = function(event) {
        this.readFileInputEventAsArrayBuffer( event, function(ArrayBuffer) {
            	mammoth.convertToHtml({arrayBuffer: ArrayBuffer})
                .then((result)=> {
                	Actions.submitArticle(result);
                })
                .done();
        });
 };

 SubmissionForm.prototype.displayResult = function(result) {
       	document.getElementById("output").innerHTML = result.value;
        var messageHtml = result.messages.map(function(message) {
            return '<li class="' + message.type + '">' + this.escapeHtml(message.message) + "</li>";
        }).join("");
       	document.getElementById("messages").innerHTML = "<ul>" + messageHtml + "</ul>";
 };
    
 SubmissionForm.prototype.readFileInputEventAsArrayBuffer = function(event, callback) {
    		var input = document.getElementById('file');
	        // var file = event.target.files[0];
	        // console.log(event.target);
	        var reader = new FileReader();

			input.onchange = function(event) {
				var file = event.target.files[0];
			    reader.readAsArrayBuffer(file);
			};

	        reader.onload = function(loadEvent) {
	            var arrayBuffer = loadEvent.target.result;
	            document.getElementById('file').innerHTML = arrayBuffer;
	            callback(arrayBuffer);
	        };
	        console.log('File Reader');
	        // reader.readAsArrayBuffer(file);    
};

SubmissionForm.prototype.escapeHtml = function(value) {
        return value
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
};


SubmissionForm.prototype.setMainView = function() {

			return (
			<div className="banner">

				    <div className="container">
					     <input type="file" id="file" onClick={(event)=> this.handleFileSelect(event) } />
						 <div className="row">
							       <div className="span8">
							          <div id="output" className="well">
							          </div>
							       </div>
							       
							        <div className="span4">
								          <div id="messages">
								          </div>
							        </div>
						</div>
				    </div>
		   
		         <div style={Style.article_save} onClick={()=> this.saveData()}>
		              <h1 style={Style.save_text}>Save</h1>
		         </div>

		    </div>
 			);
};


SubmissionForm.prototype.setDBView = function(item) {
		console.log(item);
			return (
			<div style={{alignItems: 'center'}}> 
		           		<div style={{display: 'flex',flexDirection: 'column'}}>
			            	<input style={Style.lastname} value={item.firstname} onChange={(e)=> this.editFirstName(e)} />
			            	<input style={Style.lastname}  value={item.lastname} onChange={(e)=> this.editLastName(e)}/>
			            	<input style={Style.subjects}  value={item.subject} onChange={(e)=> this.editSubject(e)}/>
			                <textarea style={Style.abstract_container}  value={item.abstract} onChange={(e)=> this.editAbstract(e)} />
		                </div>
		            
		 </div>
	);
	
};

export default new SubmissionForm();